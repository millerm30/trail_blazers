---
import MainLayout from "../layout/MainLayout.astro";
import "../styles/styles.css";
import BusinessCard from "../components/BusinessCard.astro";
import SocialIcon from "../components/SocialIcon.astro";
import Amenities from "../components/CardActivities.astro";
import heroImage from "../assets/hero_images/view2.jpg";
import type { Activity, Social } from "../types";
import { supabase } from "../lib/supabase";

const { data, error } = await supabase
  .from("businesses")
  .select("*")
  .filter("type", "eq", "lodging");

if (error) {
  console.log("Error fetching data from Supabase", error);
}

const title = "Plate Cove - Lodging";
---

<MainLayout title={title} backgroundImage={heroImage.src}>
  <main>
    <section class="flex flex-wrap justify-center mt-10 gap-4">
      {
        data.map(async (business) => {
          const businessImage = await import(
            `../assets/business_logos/${business.imageName}`
          );
          return (
            <BusinessCard
              businessImage={businessImage.default}
              businessName={business.name}
              businessDescription={business.description}
              businessAddress={business.address}
              businessPhone={business.phone}
              businessEmail={business.email}
              businessWebsite={business.website}
              businessWebName={business.webName}
            >
              {business.amenities.map((activity: Activity) => (
                <Amenities slot="before_social" activity={activity} />
              ))}
              {business.socialIcons.map((social: Social) => (
                <SocialIcon
                  socialHref={social.socialHref}
                  socialName={social.socialName}
                />
              ))}
            </BusinessCard>
          );
        })
      }
    </section>
  </main>
</MainLayout>
